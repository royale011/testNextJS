This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

### prerequisites

MongoDB is required to run this project. You can install it from [here](https://www.mongodb.com/try/download/community).

### Setting up .env file

Add .env file in the root of the project with the following content:

```
MONGODB_URI=mongodb://localhost:27017/nextjs-mongodb
SALT_ROUNDS=10
```

Then, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

## API Endpoints

### GET `/api/user?user_id=xxx&username=xxx`

Get user(s) by `user_id` or `username`. If both user_id and username are provided, user_id will be used. If none is provided, will return 400.
The returned user info will include the `user_id`, but not include the password.

### PUT `/api/user?username=xxx&password=xxx`

Register a new user. If `username` is already taken, will return 400.
A `user_id` will be automatically generated by `uuidv4()` method.
If register is successful, will return the user info, including `user_id`, but not include the password.

### GET `/api/user/login?username=xxx&password=xxx`

Login a user. If `username` or `password` is incorrect, will return 400.
If login is successful, will return the user info, including `user_id`, but not include the password.
In this demo, this can be considered as a dumb, since no further authentication method is implemented.

### GET `/api/book?book_id=xxx&bookname=xxx`

Get book(s) by `book_id` or `bookname`. If none of the parameters were provided, will return all available books that is not deleted.
Book name will be matched by regex.
The returned book info will contain the `book_id`.
Will return empty array if no book is found.

### POST `/api/book`

Insert or update information for a list of books. The JSON structure of a single book will be:

```
{
  // book name
  bookname: string,
  // book description
  description?: string;
  // price
  price: number;
  // author
  author?: string;
  // genre
  genre?: string;
  // published date
  published_date?: Date;
  // publisher
  publisher?: string;
  // language
  language?: string;
}
```

Will return 400 if the JSON structure is invalid. The function will prevent additional fields to be changed.
If new books are inserted, the `book_id` will be automatically generated by `uuidv4()` method. The return result will include the `book_id`.

### POST `/api/book/deleted`

Set a list of books to be mark as deleted or not. The JSON structure of a single book will be:

```
{
  // book id
  book_id: string;
  // is deleted
  is_deleted: boolean;
}
```

Will return 400 if the JSON structure is invalid. The function will prevent additional fields to be changed.
If new books are inserted, the `book_id` will be automatically generated by `uuidv4()` method. The return result will include the `book_id`.

### GET `/api/inventory?book_id=xxx&bookname=xxx&stocklte=xxx&stockgte=xxx`

Check the inventory status of the books.
If no parameters were provided, will return the inventory stock status of all books, including the deleted ones.
`stocklte` and `stockgte` are optional parameters to filter the inventory stock status.
Book name will be matched by regex.
Will return empty array if no book is found.

### POST `/api/inventory`

Insert or update inventory stock status for a list of books. The JSON structure of a single book will be:

```
{
  // book id
  book_id: string;
  // stock
  stock: number;
}
```

The stock number is seen as the incremental value of each books, while negative value is seen as decremental value.
After the change, the stock count in database won't be lower than 0.
If new books are inserted, the `book_id` will be automatically generated by `uuidv4()` method. The return result will include the `book_id`.

### GET `/api/order?user_id=xxx&order_id=xxx`

Get order(s) by `order_id` or `user_id`. If none of the parameters were provided, will return all orders.
The returned order info will contain the `order_id`.

### PUT `/api/order`

Create new orders. The JSON structure of a single order will be:

```
{
  // user id
  user_id: string;
  // books as map. key: book_id, value: number of books
  books: {
    [book_id: string]: number;
  };
}
```

This will check if the stock is enough for each book in all orders. If the stock is not enough, will return 400.
If all orders are created successful, the order will have a status as 0, which means "Pending". The return result will include the `order_id`.

### POST `/api/order`

Change the status of the orders. The JSON structure of a single order will be:

```
{
  // order id
  order_id: string;
  // status
  status: number;
}
```

The status enumeration will be:

```
  PENDING = 0,
  CONFIRMED = 1,
  CANCELLED = 2,
  DELIVERED = 3,
```

If the status is not in the enum, will not be executed.
This method will check if the changed orders are existed, otherwise will return 400.
If an order is changed to "Delivered", and the original status of the order is not Delivered, the stock of the books will be updated.

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
